name: Release

on:
  push:
    tags: ['v*']

jobs:
  release:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
      - name: Install dependencies
        run: sudo apt-get install -y bc jq
      - name: Run all CI-mandatory tests (Tier 1 + Tier 2 + E2E)
        run: |
          git config user.email "test@test.com"
          git config user.name "Test"
          export FORGE_EVALUATOR_CMD="tests/mocks/mock-evaluator.sh"
          bash tests/unit/statistics-unit.test.sh
          bash tests/unit/storage-local-unit.test.sh
          bash tests/unit/recommendation-engine-unit.test.sh
          bash tests/integration/skill-up-integration.test.sh
          bash tests/integration/hook-integration.test.sh
          bash tests/e2e/trial-branch-e2e.test.sh
          bash tests/e2e/forge-workflow-e2e.test.sh
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v2
        with:
          generate_release_notes: true
